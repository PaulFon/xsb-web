<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Missal + Lectionary (XSB) — Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      color-scheme: light dark;
      --bg: #f5f5f7;
      --bg-dark: #111827;
      --card-bg: #ffffff;
      --card-bg-dark: #1f2933;
      --text: #111827;
      --text-muted: #6b7280;
      --accent: #2563eb;
      --accent-dark: #1d4ed8;
      --border: #e5e7eb;
      --border-dark: #374151;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: var(--bg-dark);
        color: #e5e7eb;
      }
      .card {
        background-color: var(--card-bg-dark);
        border-color: var(--border-dark);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background-color: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .card {
      max-width: 720px;
      width: 100%;
      background-color: var(--card-bg);
      border-radius: 1.25rem;
      padding: 2rem 2.25rem;
      border: 1px solid var(--border);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.14);
    }

    @media (max-width: 640px) {
      .card {
        padding: 1.5rem 1.25rem;
        border-radius: 1rem;
      }
    }

    h1 {
      margin: 0 0 0.5rem;
      font-size: 1.6rem;
      letter-spacing: 0.02em;
    }

    .subtitle {
      margin: 0 0 1.75rem;
      font-size: 0.98rem;
      color: var(--text-muted);
    }

    .button-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem;
      margin-bottom: 1.75rem;
    }

    @media (min-width: 640px) {
      .button-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-size: 0.98rem;
      font-weight: 500;
      padding: 0.8rem 1rem;
      border-radius: 999px;
      border: 1px solid transparent;
      cursor: pointer;
      transition:
        background-color 0.15s ease,
        color 0.15s ease,
        border-color 0.15s ease,
        transform 0.08s ease;
      text-align: center;
      white-space: nowrap;
    }

    .btn.primary {
      background-color: var(--accent);
      color: #f9fafb;
      border-color: var(--accent);
    }

    .btn.primary:hover {
      background-color: var(--accent-dark);
      border-color: var(--accent-dark);
      transform: translateY(-1px);
    }

    .btn.secondary {
      background-color: transparent;
      color: var(--accent);
      border-color: rgba(148, 163, 184, 0.8);
    }

    .btn.secondary:hover {
      background-color: rgba(37, 99, 235, 0.04);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn.full {
      grid-column: 1 / -1;
    }

    .footnote {
      margin: 0;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .footnote strong {
      font-weight: 600;
    }
  </style>
</head>
<body>
  <main class="card" aria-labelledby="mlxsb-title">
    <h1 id="mlxsb-title">Missal + Lectionary (XSB)</h1>
    <p class="subtitle">
      Private workspace for Mass content (gated). Choose where to go:
    </p>

    <section class="button-grid" aria-label="Navigation options">
      <!-- Mass app (Latest) — href is updated from assets/manifest.json -->
      <a
        id="btn-mass-latest"
        class="btn primary full"
        href="#"
      >
        Open Mass app (latest)
      </a>

      <!-- Wiki -->
      <a
        class="btn secondary"
        href="https://wiki.canonicaleye.org/"
      >
        Wiki: CatholicKnowledge
      </a>

      <!-- Back to main site -->
      <a
        class="btn secondary"
        href="https://canonicaleye.org/"
      >
        Back to CanonicalEye.org
      </a>
    </section>

    <p class="footnote" id="mass-status" aria-live="polite">
      <strong>Note:</strong> “Latest” Mass page is resolved using
      <code>assets/manifest.json</code>.
    </p>
  </main>

  <script>
    (async () => {
      const statusEl = document.getElementById("mass-status");
      const massBtn = document.getElementById("btn-mass-latest");

      try {
        const resp = await fetch("/assets/manifest.json", { cache: "no-store" });
        if (!resp.ok) {
          throw new Error("HTTP " + resp.status);
        }

        const data = await resp.json();
        if (data && data.latest_url) {
          let href = String(data.latest_url);

          // Normalize relative URLs: ensure they start with "/" and are on this host
          if (!href.startsWith("http")) {
            if (!href.startsWith("/")) {
              href = "/" + href;
            }
          }

          massBtn.href = href;
          statusEl.textContent = "Latest Mass page: " + href;
        } else {
          statusEl.textContent =
            "Mass manifest found, but latest_url was not set.";
        }
      } catch (e) {
        console.error(e);
        statusEl.textContent =
          "Could not determine latest Mass page. Try again later.";
      }
    })();
  </script>
</body>
</html>
